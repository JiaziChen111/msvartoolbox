%% loading data
load deliverable1.mat

%% Apply the IRF thing to everything
R = length(draws.pphi);
horizon = 40;
FEVD_array = zeros(N,N,N,M1,M2,R);
cov_array = zeros(N,N,N,M1,M2,R);
unnormalized_OIRF_array = zeros(N,N,horizon+1,M1,M2,R);
for i_draw = 1:R
	pphi = draws.pphi(:,i_draw);
	Ssigma_array = draws.Ssigma_array(:,:,:,i_draw);
	[FEVD_array(:,:,:,:,:,i_draw),...
		cov_array(:,:,:,:,:,i_draw),...
		unnormalized_OIRF_array(:,:,:,:,:,i_draw)] = ...
		RFVAR_var_analysis(horizon,pphi,Ssigma_array,model);
end
save deliverable1_analysis.mat

%% plotting
subplot(2,1,1)
plot(0:horizon-1,prctile(squeeze(IRF1(2,1,:,:)),16,2),...
	0:horizon-1,prctile(squeeze(IRF1(2,1,:,:)),50,2),...
	0:horizon-1,prctile(squeeze(IRF1(2,1,:,:)),84,2)...
	)
subplot(2,1,2)
plot(0:horizon-1,prctile(squeeze(IRF2(2,1,:,:)),16,2),...
	0:horizon-1,prctile(squeeze(IRF2(2,1,:,:)),50,2),...
	0:horizon-1,prctile(squeeze(IRF2(2,1,:,:)),84,2)...
	)

figure
subplot(2,1,1)
plot(0:horizon-1,prctile(squeeze(IRF1(3,1,:,:)),16,2),...
	0:horizon-1,prctile(squeeze(IRF1(3,1,:,:)),50,2),...
	0:horizon-1,prctile(squeeze(IRF1(3,1,:,:)),84,2)...
	)
subplot(2,1,2)
plot(0:horizon-1,prctile(squeeze(IRF2(3,1,:,:)),16,2),...
	0:horizon-1,prctile(squeeze(IRF2(3,1,:,:)),50,2),...
	0:horizon-1,prctile(squeeze(IRF2(3,1,:,:)),84,2)...
	)

figure
subplot(2,1,1)
plot(0:horizon-1,prctile(squeeze(IRF1(1,1,:,:)),16,2),...
	0:horizon-1,prctile(squeeze(IRF1(1,1,:,:)),50,2),...
	0:horizon-1,prctile(squeeze(IRF1(1,1,:,:)),84,2)...
	)
subplot(2,1,2)
plot(0:horizon-1,prctile(squeeze(IRF2(1,1,:,:)),16,2),...
	0:horizon-1,prctile(squeeze(IRF2(1,1,:,:)),50,2),...
	0:horizon-1,prctile(squeeze(IRF2(1,1,:,:)),84,2)...
	)

figure
subplot(2,1,1)
plot(0:horizon-1,prctile(squeeze(IRF1(1,2,:,:)),16,2),...
	0:horizon-1,prctile(squeeze(IRF1(1,2,:,:)),50,2),...
	0:horizon-1,prctile(squeeze(IRF1(1,2,:,:)),84,2)...
	)
subplot(2,1,2)
plot(0:horizon-1,prctile(squeeze(IRF2(1,2,:,:)),16,2),...
	0:horizon-1,prctile(squeeze(IRF2(1,2,:,:)),50,2),...
	0:horizon-1,prctile(squeeze(IRF2(1,2,:,:)),84,2)...
	)

figure
subplot(2,1,1)
plot(0:horizon-1,prctile(squeeze(IRF1(3,2,:,:)),16,2),...
	0:horizon-1,prctile(squeeze(IRF1(3,2,:,:)),50,2),...
	0:horizon-1,prctile(squeeze(IRF1(3,2,:,:)),84,2)...
	)
subplot(2,1,2)
plot(0:horizon-1,prctile(squeeze(IRF2(3,2,:,:)),16,2),...
	0:horizon-1,prctile(squeeze(IRF2(3,2,:,:)),50,2),...
	0:horizon-1,prctile(squeeze(IRF2(3,2,:,:)),84,2)...
	)
